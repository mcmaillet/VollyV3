function addOpportunityMarker(n){var t=map.addMarker({lat:n.latitude,lng:n.longitude,title:n.name,infoWindow:{content:n.name},click:function(){openOpportunityModal(n)}});return markers.push(t),t}function openOpportunityModal(n){var t="https://vollyapp.com/Opportunities/Details/",i;$("#OpportunityId").val(n.id);$("#OpportunityModalTitle").html(n.name);$("#OpportunityModalCategory").html(n.categoryName);$("#OpportunityModalCause").html(n.causeName);$("#OpportunityModalOrganization").html(n.organizationName);$("#OpportunityModalOrganizationUrl").attr("href",n.organizationLink);$("#ModalAddressHref").attr("href","https://www.google.com/maps/search/?api=1&query="+n.address);$("#ModalAddress").html(n.address);$("#ModalDescription").html(n.description);i=n.opportunityType;i===1||i===3?($("#occurrencesSelect").css("visibility","visible"),$("#occurrencesSelect").css("position","relative")):($("#occurrencesSelect").css("visibility","hidden"),$("#occurrencesSelect").css("position","absolute"));$("#occurrencesInput").html(getOccurrenceSelectors(n.occurrenceViews));$("#fb-share").attr("href","https://www.facebook.com/sharer/sharer.php?u="+t+n.id);$("#tw-share").attr("href","https://twitter.com/share?url="+t+n.id+"&text=Volly - "+n.name);$("#ln-share").attr("href",t+n.id);document.getElementById("ln-share").innerHTML=t+n.id;$("#OpportunityModal").modal("show")}function prettyFormatDateTimes(n,t,i){var r=new Date(n+(moment(n).isDST()?"-06:00":"-07:00")),u=new Date(t+(moment(t).isDST()?"-06:00":"-07:00")),f="Coming soon!";return r.getFullYear()>=1970&&(f=u.getFullYear()>=1970?r.getFullYear()===u.getFullYear()&&r.getMonth()===u.getMonth()&&r.getDay()===u.getDay()?moment(r).format("ddd MMM D YYYY h:mm a")+" - "+moment(u).format("h:mm a"):moment(r).format("ddd MMM D YYYY h:mm a")+getSplit(i)+moment(u).format("ddd MMM D YYYY h:mm a"):moment(r).format("ddd MMM D YYYY h:mm a")),f}function getSplit(n){return n?" -<br />":" - "}function appendOpportunityPanel(n,t){var u="",i,r,f;n.opportunityType==1&&(i="Multiple Shifts",n.occurrenceViews&&(n.occurrenceViews.length===1?(r=n.occurrenceViews[0],i=prettyFormatDateTimes(r.startTime,r.endtime,!0)):n.occurrenceViews.length===0&&(i="Ongoing")),u='<div class="wrap-center"><div class="result-datetime">'+i+"<\/div><\/div>");$("#opportunityList").append('<div id="opportunity-'+n.id+'" class="col-xl-3 col-lg-4 col-md-6 col-sm-12 result-card hide"><div class="result-card-inner">'+u+'<div class="img-opp"><img src="'+n.imageUrl+'" /><\/div><div class="result-details"><div class="result-address">'+n.address+'<\/div><div class="result-org-name">'+n.organizationName+'<\/div><div class="result-name">'+n.name+"<\/div><\/div><\/div><\/div>");f=setTimeout("$('#opportunity-"+n.id+"').removeClass('hide')",5e3);$("#opportunity-"+n.id+" img").on("load",function(){clearTimeout(f);$("#opportunity-"+n.id).removeClass("hide")});$("#opportunity-"+n.id).click(function(){openOpportunityModal(n)});$("#opportunity-"+n.id).hover(function(){t.setAnimation(google.maps.Animation.BOUNCE)},function(){t.setAnimation(null)});$("#InitialOpportunity").html()==n.id&&openOpportunityModal(n)}function getOccurrenceSelectors(n){var r="",t,u,i;if(n)for(t=0;t<n.length;t++)u="",t===0&&(u="selected"),i=n[t],r=r+"<option value='"+i.id+"'"+u+">"+prettyFormatDateTimes(i.startTime,i.endTime,!1)+" ("+i.openings+" spots remaining) <\/option>";return r}function initMap(){map=new GMaps({div:"#map",lat:51.044308,lng:-114.0652801,zoom:10});$("#nothingFoundAlert").hide();$("#searchNearMe").click(function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){map.panTo(new google.maps.LatLng(n.coords.latitude,n.coords.longitude))},function(n){alert(n.message)},{timeout:1e4}):alert("Geolocation services must be enabled.")});$("#All").click();enableDatePicker()}function enableDatePicker(){$("#dateSelect").datepicker({multidate:!0,clearBtn:!0,todayHighlight:!0})}function clearOpportunities(){deleteMarkers();$("#opportunityList").empty()}function addOpportunityMarkers(n){for(var i,r,t=0;t<n.length;t++)i=n[t],r=addOpportunityMarker(i),appendOpportunityPanel(i,r)}function deleteMarkers(){clearMarkers();markers=[]}function clearMarkers(){setMapOnAll(null)}function setMapOnAll(n){for(var t=0;t<markers.length;t++)markers[t].setMap(n)}function filter(n){var t={CategoryIds:null,CauseIds:null,OrganizationIds:null,CommunityIds:null,OpportunityType:n,Dates:null,Sort:1};$.ajax({type:"POST",contentType:"application/json",url:"/api/Search/Opportunities",data:JSON.stringify(t),dataType:"json",success:function(n){clearOpportunities();n.length===0?$("#nothingFoundAlert").show():($("#nothingFoundAlert").hide(),addOpportunityMarkers(n))}})}function toggleFilterVisibility(n){$("#"+n).hasClass("active")?$("#filter-wrapper").hasClass("filter-wrapper-hide")?($("#filter-wrapper").removeClass("filter-wrapper-hide"),$("#filter-wrapper").addClass("filter-wrapper-show")):($("#filter-wrapper").removeClass("filter-wrapper-show"),$("#filter-wrapper").addClass("filter-wrapper-hide")):($("#filter-wrapper").removeClass("filter-wrapper-hide"),$("#filter-wrapper").addClass("filter-wrapper-show"))}var map,markers=[];$(".opportunityType").click(function(){var n=parseInt($(this).attr("value"));filter(n)});$("#causes-a").click(function(n){toggleFilterVisibility(n.target.id)});$("#categories-a").click(function(n){toggleFilterVisibility(n.target.id)});$("#organizations-a").click(function(n){toggleFilterVisibility(n.target.id)});$("#communities-a").click(function(n){toggleFilterVisibility(n.target.id)}),function(){$("#toggleMap").click(function(){var n=parseInt($("#toggleMap").attr("data-show"));n===1&&$("#map").css("height","85vh");$("#map").animate({opacity:n},500,function(){n===1?($("#toggleMap").attr("value","Hide Map"),$("#toggleMap").attr("data-show","0"),$("#wrap-main").removeClass("col-lg-12"),$("#wrap-main").addClass("col-lg-8"),$("#wrap-main").removeClass("col-md-12"),$("#wrap-main").addClass("col-md-8"),$("#searchNearMe").css("bottom",0),$("#searchNearMe").css("display","unset")):($("#searchNearMe").css("bottom","unset"),$("#searchNearMe").css("display","none"),$("#toggleMap").attr("value","Show Map"),$("#toggleMap").attr("data-show","1"),$("#wrap-main").removeClass("col-lg-8"),$("#wrap-main").addClass("col-lg-12"),$("#wrap-main").removeClass("col-md-8"),$("#wrap-main").addClass("col-md-12"),$("#map").css("height",0))})})}();